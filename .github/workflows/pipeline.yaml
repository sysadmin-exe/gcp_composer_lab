name: Deploy DAGs to Composer
# on:
#   push:
#     branches:
#       - main
on: [push]

jobs:
  setup-build-publish-deploy:
    name: Setup, Build, Publish, and Deploy
    runs-on: ubuntu-latest
    steps:
    - name: Checkout
      uses: actions/checkout@master

    # Setup gcloud CLI
    - name: Set up Cloud SDK
      uses: google-github-actions/setup-gcloud@master
      with:
        service_account_email: root-409@pristine-cairn-318322.iam.gserviceaccount.com #${{ secrets.GCP_EMAIL }}
        #service_account_key: -----BEGIN PRIVATE KEY-----\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQCUqj4Pc7lt4MtC\ngICksWRSfOYmf0910ex0Mej1ID/zmvqs4+Tv6PPGpu5QD4u1D5shSAaVwcxU9a6V\nZQGisBmPf6xOnai4t7ySkqdK8L4fPORGvMDazq4AfYR9FAl4fkfayO6kgeHG12St\n4UpY7ETLRxFI1VH+boEfQiQpqo6nDVtb71HKwscE5LWQJT2nyUbM8urhfPKG+1Mj\n1iwSsONSOSCS/NHEg/0xhPxxA4ZFmgFeMnJsVBrIwe2V9m3aO9DpzILLmZdrSGds\nH2tSZWBw7S0SvmXcEJIzuTuKLAcWnHHCL/5Bbe+aUAPfwZWHq7EmATkcWZZDFGP3\nsC23MQflAgMBAAECggEAEOo85POxG7opzl+CI5sGc+c/pY4zO4/e1Eqwe6GHfT97\nOaw1aoGqKQZp06StK/UCXNtN2oDCL8GDc36aXMkmI2BuucQxBBFtzIyQqdNyAmpi\ne9TyqYK+JBKj/jpHKJVPtipKEuAvUPlFfI5HcA4z9qAXrJ6O9YDbwrN7G12LXSDY\nw86LyrqQnOz74c9sn7T10QVzy0uwojnyHjpDrXkbCLnDQtMn1UmIhr/kGq7/8aWP\n7fVVONi9omqxu/TQTrwMOmyUBJh9iVmdtw5U5J0I2pA6CJzmqfoPIn1fE3CxW9om\nY+9JtKQTCu+qSFA++qjclKzUKQJbyKhTXCydhtc8WQKBgQDJKKXm+oFGXbV4f3fs\nXe7p0kS9Hy9EM7x0auwy5SnhFmEYsFwGwgUgjNuH7D1mrMwvbMW1m8LQkEqZ+EFl\n4C+EJZRfiV4Ur7BzYJWZIewVo1ysmL5DrTqz2gCmyyhmGR5e0U6G8ojtIyqD2iOi\np38Con9opX2Fdm3sM/66rCbj2QKBgQC9Me25N366svTzWIE4olSZWfmRbECnly0K\nTMqh0n8sH66X5vCFpTI7cq/c6ufvdZjV7vGi7mt95qSwtXRF86IQGqEXLT0TqMiJ\n2AXLDOIfvVTh2H25oZJTkrPDiaDbIydT3fvaegN/hFBhhyOzufpTmmaNZSKs0Uf+\n/KQdBNnY7QKBgCr7D2+p6MNTNHoZqlMLwwec0Okj56KH92VcjzlUs70PXhG7ZP5g\nqF3LGwEQ3hG5LCuZ7yidrmOH4RjC7Z5J530x1mEPZdW/sFEGuxAsKlh5Pkz2mfi1\n48wX8XmyAODHzzBtQn0dB1q739KqYmDXrxCuDdEbQxWoN1Z3yZ6zN+AJAoGAfrcQ\nFztZ/8WYVdvzQHFI5CTlCEdOznBsVDe2h8eqMW1OzKJ6eah5CmP38ajLixBiOvb8\nlDnHeN2fdFMz+x4Ab3TGa/V6sM4c8mXjC2onkUaHsXQEUO4sSRk6mT52pA7ZakyF\nQID0EtYV2BxhByEKzi/de9o+7SyGYfvoFx+GoMkCgYEAlrMph5CpDMI45bZBQfxD\nac4rSPJ1xwSemiH3IdI5k6XJh/JEqAkQrcNz59fTAq6BRdnILx1FaUQ8+4GEOoQF\nD1DP3YgxtlRe6qApc2Bnyw8sy1OftSaPwpk1Z+fEPfEHdUHHnslOupnJBxTFBM6H\nMU2hvfdYutzmUPXScgsbaY8=\n-----END PRIVATE KEY-----\n #${{ secrets.GCP_CREDENTIALS }}
        export_default_credentials: true
        project_id: pristine-cairn-318322 #${{ secrets.GCP_PROJECT_ID }}

    - name: Use gcloud CLI
      run: gcloud info

    # Upload files to GCS
    - id: upload-file
      name: upload DAGs to GCS
      uses: google-github-actions/upload-cloud-storage@main
      with:
        path: ./dags/sample.py
        destination: europe-west1-firstcomposer-de8e6ba3-bucket/dags/sample_pipeline.py

    # Example of using the output
    - id: uploaded-files
      name: output the file name uploaded
      uses: google-github-actions/upload-cloud-storage@main
      env:
        file: ${{steps.upload-file.outputs.uploaded}}%